<div id="bulk_keywords_list">
  <% keywords = domains.flat_map(&:keywords) %>
  <% if keywords.any? %>
    <div class="bg-[#0F172A]/50 border border-yellow-500/20 rounded-lg p-4 max-h-[400px] overflow-y-auto" data-bulk-generation-target="keywordsContainer">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center">
          <input type="checkbox" id="select_all" data-bulk-generation-target="selectAll" class="h-4 w-4 text-yellow-500 focus:ring-yellow-500 border-gray-300 rounded mr-2" data-action="change->bulk-generation#toggleSelectAll" />
          <label for="select_all" class="text-sm text-gray-300">Select All Keywords</label>
        </div>
        <span class="text-xs text-gray-400"><%= pluralize(keywords.count, 'keyword') %> available</span>
      </div>

      <!-- Domain-level selection checkboxes -->
      <%# unless keywords.group_by(&:domain).size <= 1 %>
        <div class="mb-4 p-3 bg-purple-500/5 border border-purple-500/20 rounded">
          <p class="text-xs text-purple-300 font-medium mb-2">Quick select by domain:</p>
          <div class="flex flex-wrap gap-2">
            <% domains.select { |domain| domain.keywords.any? }.each do |domain| %>
              <label class="flex items-center px-3 py-1 bg-purple-500/10 border border-purple-500/30 rounded text-xs text-purple-300 hover:bg-purple-500/20 cursor-pointer transition-colors">
                <input type="checkbox" 
                       data-domain="<%= domain.id %>" 
                       data-action="change->bulk-generation#toggleDomain"
                       class="h-3 w-3 text-purple-500 focus:ring-purple-500 border-gray-300 rounded mr-2" />
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="globe" class="lucide lucide-globe h-3 w-3 mr-1"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>
                <%= domain.name %> (<%= domain.keywords.size %>)
              </label>
            <% end %>
          </div>
        </div>
      <%# end %>

      <% domains.select { |domain| domain.keywords.any? }.each do |domain| %>
        <div class="mb-4">
          <div class="flex items-center mb-2 pb-1 border-b border-gray-600/30">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="globe" class="lucide lucide-globe h-4 w-4 text-purple-400 mr-2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>
            <span class="text-sm font-medium text-purple-300"><%= domain.name %></span>
            <span class="ml-2 px-2 py-0.5 bg-purple-500/20 border border-purple-500/30 rounded text-xs text-purple-400">
              <%= pluralize(domain.keywords.size, 'keyword') %>
            </span>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-1">
            <% domain.keywords.each do |keyword| %>
              <div class="flex items-center py-1">
                <% 
                  is_checked = defined?(@selected_keyword_ids) && @selected_keyword_ids&.include?(keyword.id)
                  is_checked ||= local_assigns[:selected_keyword_ids]&.include?(keyword.id)
                %>
                <input type="checkbox" 
                       name="keyword_ids[]" 
                       value="<%= keyword.id %>" 
                       id="kw_<%= keyword.id %>" 
                       data-domain-id="<%= domain.id %>"
                       class="h-4 w-4 text-yellow-500 focus:ring-yellow-500 border-gray-300 rounded mr-3" 
                       data-action="change->bulk-generation#toggleKeyword" 
                       <%= 'checked' if is_checked %> />
                <label for="kw_<%= keyword.id %>" class="text-sm text-gray-100 flex-1"><%= keyword.name %></label>
                <div class="flex space-x-1 ml-2">
                  <% if keyword.is_long_tail %>
                    <span class="px-1 py-0.5 bg-green-500/20 border border-green-500/30 rounded text-xs text-green-400">LT</span>
                  <% end %>
                  <% case keyword.search_intent %>
                  <% when 'commercial' %>
                    <span class="px-1 py-0.5 bg-yellow-500/20 border border-yellow-500/30 rounded text-xs text-yellow-400">Com</span>
                  <% when 'transactional' %>
                    <span class="px-1 py-0.5 bg-red-500/20 border border-red-500/30 rounded text-xs text-red-400">Trans</span>
                  <% when 'navigational' %>
                    <span class="px-1 py-0.5 bg-blue-500/20 border border-blue-500/30 rounded text-xs text-blue-400">Nav</span>
                  <% else %>
                    <span class="px-1 py-0.5 bg-gray-500/20 border border-gray-500/30 rounded text-xs text-gray-400">Info</span>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% elsif domains.any? %>
    <!-- Loading state when domains exist but keywords are still being discovered -->
    <div class="bg-[#0F172A]/50 border border-yellow-500/20 rounded-lg p-8 text-center">
      <div class="relative mx-auto mb-4 w-12 h-12">
        <!-- Spinning loader animation -->
        <div class="absolute inset-0 border-4 border-yellow-500/20 rounded-full"></div>
        <div class="absolute inset-0 border-4 border-transparent border-t-yellow-500 rounded-full animate-spin"></div>
        <i data-lucide="search" class="h-6 w-6 text-yellow-400 absolute inset-0 m-auto"></i>
      </div>
      <h3 class="text-lg font-medium text-yellow-400 mb-2 animate-pulse">Discovering Keywords...</h3>
      <p class="text-gray-400 text-sm mb-4">We're analyzing your domains to find the best SEO keywords for content generation.</p>
      <div class="space-y-2 text-xs text-blue-300">
        <p>üîç Scanning domain content and competitor analysis</p>
        <p>üìä Identifying high-value keyword opportunities</p>
        <p>‚è±Ô∏è This process typically takes 2-5 minutes</p>
      </div>
      <div class="mt-4 p-3 bg-green-500/10 border border-green-500/30 rounded text-xs text-green-300">
        <p class="font-medium mb-1">üí° Pro Tip</p>
        <p>Click "Refresh Keywords" if this takes longer than expected, or continue setting up other options below.</p>
      </div>
    </div>
  <% else %>
    <!-- No domains added yet -->
    <div class="bg-[#0F172A]/50 border border-yellow-500/20 rounded-lg p-8 text-center">
      <i data-lucide="search" class="h-12 w-12 text-yellow-400 mx-auto mb-4"></i>
      <h3 class="text-lg font-medium text-gray-100 mb-2">No Keywords Found</h3>
      <p class="text-gray-400 text-sm mb-4">Add domains to automatically discover keywords for content generation.</p>
      <div class="space-y-2 text-xs text-blue-300">
        <p>üí° Keywords are discovered automatically when you add domains</p>
        <p>üîÑ Use "Refresh Keywords" if they're still loading after adding a domain</p>
        <p>üìù Bulk generation works best with 5-20 targeted keywords</p>
      </div>
    </div>
  <% end %>
</div> 